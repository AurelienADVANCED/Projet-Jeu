# Docker
# Build a Docker image
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

trigger:
- main

resources:
- repo: self

variables:
  tag: '$(Build.BuildId)'

stages:
- stage:
  displayName: 'Deploy to dev env'
  dependsOn: buildpush
  jobs:        
    - deployment: DeployWebTest
      displayName: Deploy a docker image to on premise server
      environment:
        name: Docker
        resourceName: webserv
        resourceType: virtualMachine
      strategy:
        runOnce:
          deploy:
            steps:
            - script: |
                docker run  -p 8080:80 --name latest$(Build.BuildId) -d feur/latest:$(Build.BuildId)
